require 'spec_helper'

describe MaximumMatching do
  def gcd(a, b); b == 0 ? a : gcd(b, a % b); end
  def coprime?(a, b); gcd(a, b) == 1; end

  describe 'using max flow', :broken do
    let(:graph) do
      ford_fulkerson_graph = FordFulkersonGraph.new
      a.each { |e| ford_fulkerson_graph.add_edge(source, e, 1) }
      b.each { |e| ford_fulkerson_graph.add_edge(e, consumer, 1) }
      a.each_with_index do |l, lindex|
        b.each_with_index do |r, rindex|
          ford_fulkerson_graph.add_edge(l, r, 1) unless coprime?(l, r)
        end
      end
      ford_fulkerson_graph
    end
    let(:source) { 1 }
    let(:consumer) { 1000000001 }
    subject { MaximumMatching.find_max_flow(graph, source, consumer) }

    describe 'test case 1' do
      let(:a) { [2, 5, 6, 7] }
      let(:b) { [4, 9, 10, 12] }
      it { expect(subject).to eq(3) }
    end

    describe 'test case 2' do
      let(:a) { [763306408, 616420237, 713776519, 598269079, 589941887, 221262998, 472980818, 197075091, 821237151, 655363976, 258685557, 221221360, 566132723, 285563763, 991663732, 64687517, 369300997, 407044909, 113814380, 617805219, 161810648, 630191994, 40424314, 599541106, 287024978, 573462244, 66255332, 949763938, 229485975, 883079972, 665571375, 15748790, 549391337, 587968895, 66402930, 489998106, 591309456, 731158712, 475972610, 87999355, 181854861, 565385534, 966981999, 703144856, 153051739, 802618303, 53959875, 103926374, 786329195, 220383115] }
      let(:b) { [717172766, 489895710, 224861760, 827831636, 612685498, 221043909, 85719290, 308469824, 219736270, 228545209, 458533216, 41880388, 656494936, 732339225, 196540007, 210976723, 183210424, 518974529, 473784825, 825118858, 470704116, 587250223, 79622737, 336995066, 961663511, 716668443, 958195514, 205063105, 577280459, 21523655, 970783277, 521236669, 631827930, 618313254, 317458533, 176151372, 136571799, 288097081, 264944541, 189266745, 375830168, 621155909, 642282656, 237234082, 463533731, 333673760, 975048391, 190563668, 905416787, 270782855] }
      it { expect(subject).to eq(43) }
    end

    describe 'test case 3' do
      let(:a) { [866669458, 524931164, 655217860, 97881241, 703433816, 507596937, 22118787, 235748566, 118786435, 431271371, 413551932, 103167593, 356838705, 613738900, 538663919, 326359040, 443117230, 145446851, 127240754, 789090102, 171268601, 883256415, 483565230, 995628522, 128919990, 740200266, 173069979, 94245404, 79985350, 574904359, 681562020, 128025202, 733883879, 387736021, 6848110, 717957762, 5459829, 568999218, 218104995, 728993695, 802792118, 34823162, 595738033, 324706, 955294608, 841659844, 95143479, 141546346, 143446277, 70370117, 594516958, 598031774, 896524046, 134340159, 642667476, 262452881, 114126417, 419760136, 424791745, 239181976, 635011607, 793803295, 76492062, 845271411, 872246160, 117803087, 729488834, 534658703, 937208661, 20864719, 71904055, 605609160, 193593499, 288178876, 846711335, 450728712, 15567776, 240496229, 248825309, 649235814, 134843651, 514922932, 743548873, 618533006, 863346751, 514769437, 665763932, 897532414, 695073730, 586068589, 694736570, 361871411, 92044533, 597168451, 64518038, 22872968, 612290294, 814262993, 552291056, 724384018] }
      let(:b) { [430323843, 520834364, 519776964, 75407989, 952609324, 807248243, 412466514, 247454670, 442264487, 491258902, 306671358, 264727494, 836325110, 628582315, 903836772, 278236285, 245308865, 530419974, 563850709, 940981988, 807623968, 284825648, 323583161, 33559112, 32724382, 242841030, 210228299, 489350138, 438329515, 135215784, 326911322, 928347988, 68867022, 540242952, 95362908, 534522254, 584355737, 617082188, 894730513, 848163857, 886423972, 33604554, 796468076, 973347969, 676342173, 444886200, 457232705, 13550358, 900528483, 864919761, 182544744, 68309004, 313129119, 71612395, 998646833, 672587315, 614013556, 66878246, 681661301, 649157321, 170133676, 928886535, 382808214, 144096323, 51236776, 788479944, 8283208, 215329732, 329788689, 896131275, 975488902, 151781105, 567387258, 250218915, 449251739, 814402680, 752526818, 979961103, 947097438, 510777062, 930872135, 542532710, 924619967, 896082065, 148416432, 206424846, 989224977, 878721524, 427579837, 854003985, 611729383, 124450053, 568858524, 944584, 636165919, 512450379, 344061772, 265668792, 476851419, 32794917] }
      it { expect(subject).to eq(89) }
    end
  end
end
